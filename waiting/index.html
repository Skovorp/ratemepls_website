<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Processing...</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #000;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .wrap {
            width: 100vw;
            padding-left: 2vw;
            padding-right: 2vw;
        }
        video {
            display: block;
            width: 100%;
            height: auto;
            max-height: 100vh;
        }
    </style>
    <link rel="preload" href="https://animation-files.bleuje.com/2024/2024_trefoildigits.mp4" as="video" type="video/mp4">
    <link rel="preconnect" href="https://animation-files.bleuje.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
</head>
<body>
    <div class="wrap">
        <video src="https://animation-files.bleuje.com/2024/2024_trefoildigits.mp4" autoplay muted loop playsinline></video>
    </div>

    <script>
        (async () => {
            const start = Date.now();
            let id = sessionStorage.getItem('jobId');
            if (!id) {
                const dataUrl = sessionStorage.getItem('uploadedImageDataUrl') || '';
                const base64Image = dataUrl.split(',')[1] || '';
                const runRes = await fetch('https://api.runpod.ai/v2/t20dfqb9no6wiz/run', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer rpa_XOVY7PSJZ97BEIAJ04PPQL1G8D7DGPD120A6FMR9gsyylk'
                    },
                    body: JSON.stringify({ input: { image: base64Image } })
                });
                const runJson = await runRes.json();
                id = runJson.id;
                sessionStorage.setItem('jobId', id);
            }
            while (true) {
                const r = await fetch(`https://api.runpod.ai/v2/t20dfqb9no6wiz/status/${id}`, {
                    headers: { 'Authorization': 'Bearer rpa_XOVY7PSJZ97BEIAJ04PPQL1G8D7DGPD120A6FMR9gsyylk' }
                });
                const j = await r.json();
                if (j.status === 'COMPLETED') {
                    const elapsed = Date.now() - start;
                    const remaining = 3000 - elapsed;
                    if (remaining > 0) { await new Promise(res => setTimeout(res, remaining)); }
                    sessionStorage.setItem('raw_score', String(j.output.raw_score));
                    sessionStorage.setItem('percentile', String(j.output.percentile));
                    window.location.replace('../result/');
                    break;
                }
                await new Promise(res => setTimeout(res, 1500));
            }
        })();
    </script>
</body>
</html>


